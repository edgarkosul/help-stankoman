+++
title = 'Импорт товаров из Metalmaster'
date = 2026-02-20T12:10:00+03:00
+++

## 1. Где находится раздел

В админ-панели есть два пункта:

1. `Импорт Metalmaster`  
   Страница запуска проверки и импорта товаров из каталога Metalmaster.
2. `История импортов`  
   Журнал всех запусков (какой режим, сколько обработано, были ли ошибки).

## 2. Что важно понять до начала

1. Сначала обновите список категорий кнопкой `Перегенерировать список категорий`.
2. Сначала всегда запускайте `Запустить dry-run`.
3. Кнопка `Импортировать в базу` сразу вносит изменения в БД.
4. Запуск выполняется не мгновенно: дождитесь завершения и проверяйте статус в блоке результатов.

## 3. Рекомендуемый безопасный сценарий работы

1. Откройте страницу `Импорт Metalmaster`.
2. Нажмите `Перегенерировать список категорий`.
3. Выберите категорию Metalmaster (или оставьте пусто для импорта всех категорий, крайне не рекомендуется). 
   Несколько причин не импортировать сразу все категории:
   - ip сервера может попасть под бан ip на сайте доноре; 
   - все товары попадут в одну категорию "Импортированные товары" и потом крайне трудно будет раскидать их по категориям и настроить фильтры.
     
4. Оставьте безопасные настройки (по умолчанию):
   - `Публиковать импортированные товары` = выключено,
   - `Скачивать изображения` = включено,
   - `Пропускать уже существующие товары` = по задаче.
5. Нажмите `Запустить dry-run`.
6. Дождитесь завершения и проверьте блок `Последний запуск Metalmaster`.
7. Убедитесь, что результат вас устраивает (объем, ошибки, примеры).
8. Только после этого нажмите `Импортировать в базу`.
9. Проверьте итог в `История импортов`.

## 4. Как работают параметры на странице

## 4.1 Категория на Metalmaster

1. Пустое значение = импорт по всем категориям.
2. При выборе конкретной категории импорт ограничится только ею.
3. В списке показываются первые категории, но поиск работает по всему перечню.

## 4.2 Лимит URL (0 = все)

1. `0` — обрабатываются все найденные товарные URL.
2. Любое число `> 0` — берутся только первые N URL.

Рекомендация:

1. Для теста ставьте небольшой лимит (например, 20-50).
2. Для полного запуска возвращайте `0`.

## 4.3 Таймаут запроса, сек

1. Максимальное время ожидания ответа от источника.
2. Если источник отвечает медленно, слишком маленький таймаут может увеличивать число ошибок.

## 4.4 Задержка между запросами, мс

1. Пауза между запросами к источнику.
2. Больше значение = медленнее, но мягче нагрузка на источник.

## 4.5 Примеры строк в dry-run

1. Сколько примеров показать в режиме проверки.
2. На запись в БД не влияет.

## 4.6 Публиковать импортированные товары

1. В write-режиме включает показ товара на сайте.
2. Если выключено, импортированные/обновленные товары остаются не опубликованными, что рекомендуется как поведение по умолчанию.

## 4.7 Скачивать изображения

1. При включении изображения скачиваются локально.
2. Изображения подставляются товарам автоматически.
3. Дополнительная обработка изображений выполняется системой автоматически.

## 4.8 Пропускать уже существующие товары

1. Если включено, найденные существующие товары не обновляются.
2. Существующий товар определяется по его `slug`.

## 5. Режимы запуска

## 5.1 Запустить dry-run

1. Данные в БД не изменяются.
2. Показывается, сколько URL найдено, сколько обработано, сколько ошибок.
3. Можно оценить объем и качество данных до реального импорта.

## 5.2 Импортировать в базу

1. Создает и обновляет товары в БД.
2. Результат зависит от параметров `Публиковать импортированные товары`, `Скачивать изображения`, `Пропускать уже существующие товары`.

## 6. Как понимать блок "Последний запуск Metalmaster"

Основные поля:

1. `Статус`:
   - `В ожидании` (`pending`),
   - `Проверено` (`dry_run`),
   - `Применено` (`applied`),
   - `Ошибка` (`failed`).
2. `Режим`: `dry-run` или `write`.
3. `Категория`: выбранная категория или `все`.
4. `Найдено URL` — сколько товарных ссылок найдено.
5. `Обработано` — сколько ссылок уже обработано.
6. `Ошибок` — проблемные URL/системные ошибки.
7. `Создано / Обновлено / Пропущено` — итог по товарам.
8. `Скачано изображений` — статистика по изображениям.
9. `Примеры dry-run` — количество сохраненных примеров.
10. `Последние ошибки` — последние сообщения об ошибках.

## 7. Что делает система с товарами

1. При создании/обновлении заполняются: название, бренд, цена, валюта, наличие, количество, описание, характеристики, изображения, SEO-поля.
2. Товары привязываются к категории Импортированные товары (если она настроена в системе).
3. Если включен параметр `Пропускать уже существующие товары`, существующие товары не изменяются.

## 8. Страница История импортов

Используйте ее, чтобы:

1. Посмотреть все запуски типа `Metalmaster`.
2. Проверить финальный статус и итоги.
3. Открыть проблемы (issues), если запуск был с ошибками.

## 9. Частые ситуации и что делать

## 9.1 Запуск долго "В ожидании"

Причина:

1. Идет фоновая обработка или есть временная техническая задержка.

Что делать:

1. Подождать и обновить страницу.
2. Проверить позже в `История импортов`.
3. Если статус не меняется долго, передать задачу техническому специалисту.

## 9.2 Найдено URL = 0

Причины:

1. Не выбрана нужная категория.
2. В выбранной категории сейчас нет подходящих URL товаров.
3. Источник временно недоступен.

Что делать:

1. Обновить список категорий через `Перегенерировать список категорий`.
2. Проверить выбор категории (или запустить без фильтра по категории).
3. Повторить dry-run позже.

## 9.3 Ошибок много

Причины:

1. Ошибки загрузки страниц/сети.
2. Ошибки парсинга отдельных карточек.
3. Ошибки скачивания изображений.

Что делать:

1. Смотреть блок `Последние ошибки`.
2. Уменьшить `Лимит URL` и проверить на небольшой партии.
3. При необходимости временно отключить `Скачивать изображения` для диагностики.

## 10. Короткий чек-лист перед кнопкой "Импортировать в базу"

1. Список категорий обновлен.
2. Dry-run выполнен и результат понятен.
3. Последний запуск завершен и статус обновился.
4. Параметры выставлены осознанно (`Публиковать импортированные товары`, `Скачивать изображения`, `Пропускать уже существующие товары`).
5. Понимаете ожидаемый объем `Создано/Обновлено/Пропущено`.
6. Критичных ошибок нет.

Если все пункты выполнены, можно запускать `Импортировать в базу`.
